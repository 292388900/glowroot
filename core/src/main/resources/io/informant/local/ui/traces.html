<!doctype html>
<!--
  Copyright 2012 the original author or authors.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Informant | Trace explorer</title>
<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
<link rel="stylesheet" href="libs/bootstrap/2.1.1/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="libs/bootstrap-datepicker/0.1-nightly-20120928-1/css/datepicker.css"
    type="text/css" />
<link rel="stylesheet" href="libs/qtip/2.0.0-nightly-20120910/jquery.qtip.min.css"
    type="text/css" />
<link rel="stylesheet" href="css/informant.css" type="text/css" />
<script type="text/javascript" src="libs/jquery/1.8.1/jquery.min.js"></script>
<script type="text/javascript" src="libs/bootstrap/2.1.1/js/bootstrap.min.js"></script>
<script type="text/javascript"
    src="libs/bootstrap-datepicker/0.1-nightly-20120928-1/js/bootstrap-datepicker.js">
</script>
<script type="text/javascript" src="libs/moment/1.7.0/moment.min.js"></script>
<script type="text/javascript" src="libs/handlebars/1.0.rc.1/handlebars.js"></script>
<!--[if lt IE 9]>
<script type="text/javascript" src="libs/flashcanvas/20110201/flashcanvas.js"></script>
<![endif]-->
<script type="text/javascript" src="libs/flot/0.8-nightly-20120912-1/jquery.flot.js"></script>
<script type="text/javascript" src="libs/flot/0.8-nightly-20120912-1/jquery.flot.time.js"></script>
<script type="text/javascript" src="libs/flot/0.8-nightly-20120912-1/jquery.flot.selection.js">
</script>
<script type="text/javascript" src="libs/flot/0.8-nightly-20120912-1/jquery.flot.navigate.js">
</script>
<script type="text/javascript" src="libs/spin/1.2.6/spin.min.js"></script>
<script type="text/javascript" src="libs/qtip/2.0.0-nightly-20120910/jquery.qtip.min.js"></script>
<script type="text/javascript" src="js/traces.js"></script>
<script type="text/javascript" src="js/informant.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    configureAjaxError()
    var plot, normalPoints, errorPoints, activePoints, currentItem, prospectiveItem, tooltipShowing
    var plotselecting
    var options = {
      legend: { show: false },
      series: {
        points: { show: true }
      },
      grid: { hoverable: true, clickable: true },
      xaxis: { mode: 'time' },
      yaxis: { ticks: 10, zoomRange : false },
      zoom: { interactive: true, amount : 1.5 },
      colors: ['#edc240', '#cb4b4b', '#afd8f8'],
      selection: { mode: 'xy' }
    }
    // need to track window dimensions to identify real window resizes in IE which sends window
    // resize event when any element on the page is resized
    var windowWidth = $(window).width()
    var windowHeight = $(window).height()
    $(window).resize(function(e){
      // check plot in case this is a resize before initial plot is rendered
      if (plot && ($(window).width() != windowWidth || $(window).height() != windowHeight)) {
        windowWidth = $(window).width()
        windowHeight = $(window).height()
        plot = $.plot($('#placeholder'), plot.getData(), plot.getOptions())
      }})
    function plotResponseData(from, to) {
      var fromAsDate = new Date(from)
      fromAsDate.setHours(0,0,0,0)
      var zoomRangeFrom = fromAsDate.getTime()
      var zoomRangeTo = zoomRangeFrom + 24 * 60 * 60 * 1000; // zoomRangeFrom + 24 hours
      from -= new Date(from).getTimezoneOffset() * 60 * 1000
      to -= new Date(to).getTimezoneOffset() * 60 * 1000
      zoomRangeFrom -= new Date(zoomRangeFrom).getTimezoneOffset() * 60 * 1000
      zoomRangeTo -= new Date(zoomRangeTo).getTimezoneOffset() * 60 * 1000
      options.xaxis.min = from
      options.xaxis.max = to
      options.xaxis.zoomRange = [ zoomRangeFrom, zoomRangeTo ]
      // reset yaxis min/max so it will be auto calculated to fit data points
      options.yaxis.min = undefined
      options.yaxis.max = undefined
      plot = $.plot($('#placeholder'), [normalPoints, errorPoints, activePoints], options)
      updateTimeFilter()
    }
    function itemsEqual(plotItem1, plotItem2) {
      if (!plotItem1 && !plotItem2) {
        return true
      } else if (!plotItem1) {
        return false
      } else if (!plotItem2) {
        return false
      } else {
        return plotItem1.seriesIndex == plotItem2.seriesIndex && plotItem1.dataIndex
            == plotItem2.dataIndex
      }
    }
    function hideTooltip() {
      hideSpinner('#tooltipSpinner')
      $('#placeholder').qtip('hide')
      tooltipShowing = false
    }
    $('#placeholder').bind('plotzoom', function (event, plot) {
      // cancel any refresh in action
      if (refreshQueryString) {
        refreshQueryString = undefined
        hideSpinner('#refreshButtonSpinner')
        showAndFadeErrorMessage('#refreshButtonCancelByZoom')
      }
      updateTimeFilter()
      if (currentItem) {
        // highlight gets out of sync on zoom
        plot.unhighlight()
        plot.highlight(currentItem.seriesIndex, currentItem.dataIndex)
        // leave the highlight, but cancel the tooltip since it is out of sync also, the user can
        // get tooltip again by hovering over the highlighted data point
        hideTooltip()
      }
    })
    $('#placeholder').mousedown(function() {
      hideTooltip()
    })
    $(document).keyup(function(e) {
      if (e.keyCode == 27 && currentItem) { // esc key
        hideTooltip()
      }
    })
    $('#placeholder').bind('plothover', function (event, pos, item) {
      if (plotselecting) {
        return
      }
      if (item && itemsEqual(item, currentItem) && !tooltipShowing) {
        // this happens after a zoom when the data point is still highlighted but the tooltip has
        // been hidden, and then the user hovers back over the same highlighted data point
        // in this case just show the tooltip immediately
        tooltipShowing = true
        showTraceDetailTooltip(item)
      } else if (item && !itemsEqual(item, currentItem)) {
        if (itemsEqual(item, prospectiveItem)) {
          // another handler is already waiting and will display the tooltip after the timeout below
          return
        }
        prospectiveItem = item
        // hover must last at least 100 milliseconds to prevent accidental hovers and unnecessary
        // server requests
        setTimeout(function() {
          if (!itemsEqual(item, prospectiveItem)) {
            // user moved on before 100 milliseconds, cancel the tooltip
            return
          }
          currentItem = item
          plot.unhighlight()
          $('#placeholder').qtip('hide')
          plot.highlight(item.series, item.datapoint)
          tooltipShowing = true
          showTraceDetailTooltip(item)
        }, 100)
      } else {
        prospectiveItem = null
      }
    })
    var cancelingPlotSelection
    $(document).keyup(function(e) {
      if (e.keyCode == 27 && plotselecting) { // esc key
        plot.clearSelection()
        cancelingPlotSelection = true
      }
    })
    $(document).mousedown(function(e) {
      // need to reset this variable at some point, now seems good
      cancelingPlotSelection = false
    })
    $('#placeholder').bind('plotselecting', function (event, ranges) {
      if (ranges) {
        // plotselecting events are triggered with null ranges parameter when '!selectionIsSane()'
        // (see jquery.flot.selection.js)
        plotselecting = true
      }
    })
    $('#placeholder').bind('plotunselected', function (event, ranges) {
      plotselecting = false
    })
    $('#placeholder').bind('plotselected', function (event, ranges) {
      if (cancelingPlotSelection) {
        // unfortunately, plotselected is still called after plot.clearSelection() in the keyup
        // event handler for the esc key
        plot.clearSelection()
        return
      }
      // cancel any refresh in action
      if (refreshQueryString) {
        refreshQueryString = undefined
        hideSpinner('#refreshButtonSpinner')
        showAndFadeErrorMessage('#refreshButtonCancelByZoom')
      }
      options.xaxis.min = ranges.xaxis.from
      options.xaxis.max = ranges.xaxis.to
      // round min/max to the nearest millisecond in outward direction so that they encompass the
      // requested selection
      options.yaxis.min = Math.floor(ranges.yaxis.from * 1000) / 1000
      options.yaxis.max = Math.ceil(ranges.yaxis.to * 1000) / 1000
      plot = $.plot($('#placeholder'), plot.getData(), options)
      plotselecting = false
      updateTimeFilter()
      updateDurationFilter()
      if (currentItem) {
        // highlight gets out of sync on zoom
        plot.unhighlight()
        plot.highlight(currentItem.seriesIndex, currentItem.dataIndex)
        // leave the highlight, but cancel the tooltip since it is out of sync also, the user can
        // get tooltip again by hovering over the highlighted data point
        hideTooltip()
      }
    })
    function updateTimeFilter() {
      var from = Math.floor(plot.getAxes().xaxis.min)
      var to = Math.ceil(plot.getAxes().xaxis.max)
      // shift timezone
      from += new Date(from).getTimezoneOffset() * 60 * 1000
      to += new Date(to).getTimezoneOffset() * 60 * 1000
      // TODO use localized time format
      // currently momentjs provides only 'LT' for localized time but this does not include seconds
      // see http://momentjs.com/docs/#/customization/long-date-formats
      $('#timeFilter').html(moment(from).format('h:mm:ss A') + ' &nbsp; to &nbsp; '
          + moment(to).format('h:mm:ss A (Z)'))
    }
    function updateDurationFilter() {
      $('#durationLow').val(plot.getAxes().yaxis.min)
      $('#durationHigh').val(plot.getAxes().yaxis.max)
      $('#durationComparator').val('between').change()
    }
    function refresh() {
      // TODO use localized date format, see more detailed comment at datepicker construction since
      // the format needs to be sync'd between the date picker and this parsing
      var date = moment($('#dateFilter').val(), 'MM/DD/YYYY')
      var from
      var to
      if (plot) {
        from = moment(Math.floor(plot.getAxes().xaxis.min))
        to = moment(Math.ceil(plot.getAxes().xaxis.max))
        // shift timezone
        from.add('minutes', from.zone())
        to.add('minutes', to.zone())
        var fromAsDate = from.clone()
        fromAsDate.hours(0)
        fromAsDate.minutes(0)
        fromAsDate.seconds(0)
        fromAsDate.milliseconds(0)
        if (date.valueOf() == fromAsDate.valueOf()) {
          // dateFilter hasn't changed
          from = from.valueOf()
          to = to.valueOf()
        } else {
          // dateFilter has changed
          from = date.valueOf()
          to = date.valueOf() + 24 * 60 * 60 * 1000
        }
      } else {
        // plot.getAxes() is not yet available because the refresh button was hit refresh during
        // (a possibly very long) initial load and
        from = date.valueOf()
        to = date.valueOf() + 24 * 60 * 60 * 1000
      }
      var limit = $('#limitFilter').val()
      var queryString = buildQueryString()
      getTracePoints(from, to, limit, queryString, false)
    }
    function buildQueryString() {
      var queryString = ''
      var durationLow = $('#durationLow').val() * 1000
      if (durationLow) {
        queryString += '&low=' + durationLow
      }
      var durationHigh = $('#durationHigh').val() * 1000
      if (durationHigh) {
        queryString += '&high=' + durationHigh
      }
      if ($('#errorOnlyFilter').is(':checked')) {
        queryString += '&errorOnly=true'
      }
      if ($('#fineOnlyFilter').is(':checked')) {
        queryString += '&fineOnly=true'
      }
      var descriptionComparator = $('#descriptionComparator').val()
      var description = $('#descriptionFilter').val()
      if (description) {
        queryString += '&descriptionComparator=' + descriptionComparator
        queryString += '&description=' + description
      }
      var userIdComparator = $('#userIdComparator').val()
      var userId = $('#userIdFilter').val()
      if (userId) {
        queryString += '&userIdComparator=' + userIdComparator
        queryString += '&userId=' + userId
      }
      var background = $('#backgroundFilter').val()
      if (background) {
        queryString += '&background=' + background
      }
      return queryString
    }
    var refreshQueryString
    var loadDetailId
    function getTracePoints(from, to, limit, queryString, initialLoad) {
      queryString = 'from=' + from + '&to=' + to + '&limit=' + limit + queryString
      // handle crazy user clicking on the button
      if (!initialLoad && queryString == refreshQueryString) return
      if (initialLoad) {
        showSpinner('#initialLoadSpinner')
      } else {
        // hide initialLoadSpinner just in case the refresh button was hit during (a very long)
        // initial load
        hideSpinner('#initialLoadSpinner')
        if (!refreshQueryString) {
          // if refreshQueryString is defined, that means spinner is already showing
          showSpinner('#refreshButtonSpinner')
        }
      }
      if (!initialLoad) {
        refreshQueryString = queryString
      }
      $.getJSON('trace/points?' + queryString, function(response) {
        if (initialLoad && refreshQueryString) {
          // a refresh query has been posted since this initial load
          return
        } else if (!initialLoad && refreshQueryString != queryString) {
          // a different query string has been posted since this one
          // or the refresh was 'canceled' by a zoom action
          return
        }
        refreshQueryString = undefined
        if (initialLoad) {
          hideSpinner('#initialLoadSpinner')
        } else {
          hideSpinner('#refreshButtonSpinner')
          showAndFadeSuccessMessage('#refreshSuccessMessage')
        }
        normalPoints = response.normalPoints
        errorPoints = response.errorPoints
        activePoints = response.activePoints
        if (response.limitExceeded) {
          $('#limit').text(limit)
          $('#limitExceeded').css('display', 'inline-block')
        } else {
          $('#limitExceeded').hide()
        }
        hideTooltip()
        currentItem = null
        $('#detailTabContent').html('')
        // shift for timezone
        for (var i = 0; i < normalPoints.length; i++) {
          normalPoints[i][0] -= new Date(normalPoints[i][0]).getTimezoneOffset() * 60 * 1000
        }
        for (var i = 0; i < errorPoints.length; i++) {
          errorPoints[i][0] -= new Date(errorPoints[i][0]).getTimezoneOffset() * 60 * 1000
        }
        for (var i = 0; i < activePoints.length; i++) {
          activePoints[i][0] -= new Date(activePoints[i][0]).getTimezoneOffset() * 60 * 1000
        }
        plotResponseData(from, to)
      })
    }
    function showTraceDetailTooltip(item) {
      var x = item.pageX
      var y = item.pageY
      var id
      if (item.seriesIndex == 0) {
        id = normalPoints[item.dataIndex][2]
      } else if (item.seriesIndex == 1) {
        id = errorPoints[item.dataIndex][2]
      } else {
        id = activePoints[item.dataIndex][2]
      }
      var spinner = new Spinner({ lines: 10, width: 3, radius: 6, top: 2, left: 2 })
      function displaySpinner() {
        if (spinner) {
          var html = '<div id="tooltipSpinner" style="display: inline-block; width: 35px;'
            + ' height: 31px"></div>'
          $('#placeholder').qtip({
            content: {
              text: html
            },
            position: {
              target: [ x , y + 5 ],
              viewport: $('#placeholder')
            }
          })
          $('#placeholder').qtip('show')
          spinner.spin($('#tooltipSpinner').get(0))
        }
      }
      // small delay so that if there is an immediate response the spinner doesn't blink
      setTimeout(displaySpinner, 100)
      var currentItemForJson = currentItem
      $.getJSON('trace/summary/' + id, function(response) {
        spinner.stop()
        spinner = null
        if (!itemsEqual(currentItem, currentItemForJson)) {
          // too slow, the user has moved on to another point already
          return
        }
        summaryTrace = response
        var html = traceSummaryTemplate(summaryTrace)
        var showDetailHtml = '<div style="margin-top: 0.5em">'
            + '<span tabindex="0" class="lightbtn red pad1 qtip-override" id="showDetail"'
            + ' style="padding-top: 4px; padding-bottom: 4px">show detail</span></div>'
        $('#placeholder').qtip({
          content: {
            text: '<div class="indent1">' + html + '</div>' + showDetailHtml
          },
          position: {
            my: 'bottom center',
            target: [ x , y + 5 ],
            viewport: $('#tooltipBoundary')
          },
          style: {
            classes: 'qtip-override'
          },
          hide: {
            event: 'unfocus'
          },
          show: {
            event: false
          }
        })
        $('#placeholder').qtip('show')
        $('#showDetail').click(function() {
          // handle crazy user clicking on the 'show detail' link
          if (id == loadDetailId) return
          if (!loadDetailId) {
            // if loadDetailId is defined, that means spinner is already showing
            showSpinner('#detailTabSpinner')
          }
          loadDetailId = id
          $('#detailTabContent').html('')
          $('a[href="#detailTab"]').tab('show')
          $.getJSON('trace/detail/' + id, function(response) {
            if (loadDetailId != id) {
              // a different id has been posted since this one
              return
            }
            loadDetailId = undefined
            detailTrace = response
            detailTrace.showExport = true
            var html = traceSummaryTemplate(detailTrace)
            hideSpinner('#detailTabSpinner')
            $('#detailTabContent').html('<div class="indent1">' + html + '</div>')
            $('#detailTabContent').append('<br>')
            var detailHtml = traceDetailTemplate(detailTrace)
            hideTooltip()
            $('#detailTabContent').append(detailHtml)
          })
          return false
        })
      })
    }
    $('#moreFiltersButton').click(function(e) {
      if ($('#moreFilters').is(':visible')) {
        $('#moreFiltersButton').html('more filters')
        $('#moreFilters').hide()
      } else {
        $('#moreFiltersButton').html('less filters')
        $('#moreFilters').show()
      }
      // without preventDefault, click triggers form submission
      e.preventDefault()
    })
    var now = new Date()
    var today = new Date()
    today.setHours(0,0,0,0)
    // TODO use bootstrap-datepicker momentjs backend when it's available and then use momentjs's
    // localized format 'moment.longDateFormat.L' both here and when parsing date
    // see https://github.com/eternicode/bootstrap-datepicker/issues/24
    $('#dateFilter').val(moment(today).format('MM/DD/YYYY'))
    $('#dateFilter').datepicker({format: 'mm/dd/yyyy', autoclose: true, todayHighlight: true})
    $('#durationComparator').change(function() {
      if ($('#durationComparator').val() == 'greater') {
        $('#durationLowDiv').show()
        $('#durationAndDiv').hide()
        $('#durationHighDiv').hide()
        $('#durationHigh').val('')
      } else if ($('#durationComparator').val() == 'less') {
        $('#durationLowDiv').hide()
        $('#durationLow').val('')
        $('#durationAndDiv').hide()
        $('#durationHighDiv').show()
      } else if ($('#durationComparator').val() == 'between') {
        $('#durationLowDiv').show()
        $('#durationAndDiv').show()
        $('#durationHighDiv').show()
      }
    })
    $('#refreshButton').click(refresh)
    $(".refresh-data-on-enter-key").keypress(function(event) {
      if (event.which == 13) {
        refresh()
        // without preventDefault, enter triggers 'more filters' button
        event.preventDefault()
      }
    })
    $('#zoomOut').click(function() { plot.zoomOut() })
    // get the last 2 hours, but nothing prior to today (e.g. if 'now' is 1am)
    var from = Math.max(today.getTime(), now.getTime() - 2 * 60 * 60 * 1000)
    // now + 15 minutes, this is primarily to set the right-hand border for the chart
    var to = now.getTime() + 15 * 60 * 1000
    getTracePoints(from, to, 500, '', true)
  })
</script>
</head>
<body class="pin-vertical-scrollbar">
  <div class="header">
    <a class="header-logo" href=".">
        <!-- lack of spaces on this line is important -->
        Informant</a><span class="header-page-name">Trace explorer</span>
    <div class="header-see-also dropdown pull-right">
      <!-- role is needed for keyboard nav to work (tab to link, then arrow key down) -->
      <a href="#" class="dropdown-toggle red" role="button" data-toggle="dropdown">see also:</a>
      <ul class="dropdown-menu" role="menu" style="margin: 0">
        <li><a tabindex="-1" href="configuration.html">configuration</a></li>
        <li><a tabindex="-1" href="threaddump.html">full thread dump</a></li>
        <li><a tabindex="-1" href="admin.html">administration</a></li>
      </ul>
    </div>
  </div>
  <br>
  <div id="tooltipBoundary" style="display: none; width: 100%; height: 10000px"></div>
  <div>
    <div id="placeholder" style="height: 300px">
      <div class="button-spinner" id="initialLoadSpinner"
          style="width: 100%; height: 100%; margin: 0px auto"></div>
    </div>
    <div style="width: 100%; text-align: center; font-style: italic; margin: 4px 0">
      use mouse scroll wheel to zoom in and out
      (or double click to zoom in and<span tabindex="0" class="lightbtn red" id="zoomOut"
          style="font-style: italic">click here to zoom out</span>)
    </div>
    <!-- min-height to take up a little space even when no error message -->
    <div style="text-align:center; min-height: 20px">
      <div class="alert alert-error" id="limitExceeded"
          style="display: none; margin: 6px auto 0px auto; padding: 8px 35px; font-weight: bold">
        Specified limit exceeded, only displaying the slowest <span id="limit"></span> traces
      </div>
    </div>
  </div>
  <br>
  <ul class="nav nav-tabs" id="tab">
    <li class="active"><a href="#filterTab" data-toggle="tab">Filter</a></li>
    <li><a href="#detailTab" data-toggle="tab">Detail</a></li>
  </ul>
  <div class="tab-content" id="tabContent" style="padding-top: 10px">
    <div class="tab-pane fade in active" id="filterTab">
      <form class="form-horizontal">
        <fieldset>
          <div class="control-group">
            <label class="control-label" for="dateFilter">Date</label>
            <div class="controls">
              <input type="text" class="input-small refresh-data-on-enter-key" id="dateFilter">
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="timeFilter">Time</label>
            <div class="controls">
              <!-- maybe bootstrap issue that padding-top is required for vertical alignment? -->
              <span class="help-inline" id="timeFilter" style="padding-top: 5px">All day</span>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="durationBounds">Duration</label>
            <div class="controls">
              <select class="input-medium0" id="durationComparator">
                <option value="greater">Greater than</option>
                <option value="less">Less than</option>
                <option value="between">Between</option>
              </select>
              <div class="input-append" id="durationLowDiv">
                <input type="text" class="input-mini refresh-data-on-enter-key" id="durationLow">
                <span class="add-on">seconds</span>
              </div>
              <div class="input-append" id="durationAndDiv" style="display: none">and</div>
              <div class="input-append" id="durationHighDiv" style="display: none">
                <input type="text" class="input-mini refresh-data-on-enter-key" id="durationHigh">
                <span class="add-on">seconds</span>
              </div>
            </div>
          </div>
          <div class="control-group">
            <div class="controls">
              <label class="checkbox">
                <input type="checkbox" class="input-small" id="errorOnlyFilter" value="true">
                <span class="help-inline">Display only errors</span>
              </label>
            </div>
          </div>
          <div class="control-group">
            <div class="controls">
              <label class="checkbox">
                <input type="checkbox" class="input-small" id="fineOnlyFilter" value="true">
                <span class="help-inline">
                  Display only traces with fine-grained profiling data
                </span>
              </label>
            </div>
          </div>
          <div id="moreFilters" style="display: none">
            <div class="control-group">
              <label class="control-label" for="descriptionFilter">Description</label>
              <div class="controls">
                <select class="input-medium0" id="descriptionComparator">
                  <option value="begins">Begins with</option>
                  <option value="equals">Equals</option>
                  <option value="ends">Ends with</option>
                  <option value="contains">Contains</option>
                </select>
                <input type="text" class="input-medium refresh-data-on-enter-key"
                    id="descriptionFilter">
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" for="userIdFilter">User ID</label>
              <div class="controls">
                <select class="input-medium0" id="userIdComparator">
                  <option value="begins">Begins with</option>
                  <option value="equals">Equals</option>
                  <option value="ends">Ends with</option>
                  <option value="contains">Contains</option>
                </select>
                <input type="text" class="input-medium refresh-data-on-enter-key" id="userIdFilter">
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" for="backgroundFilter">Background</label>
              <div class="controls">
                <select class="input-xlarge0" id="backgroundFilter">
                  <option value="" selected="selected"></option>
                  <option value="false">Exclude background traces</option>
                  <option value="true">Include only background traces</option>
                </select>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" for="limitFilter">Limit</label>
              <div class="controls">
                <select class="input-small" id="limitFilter">
                  <option value="100">100</option>
                  <option value="200">200</option>
                  <option value="500" selected="selected">500</option>
                  <option value="1000">1,000</option>
                  <option value="2000">2,000</option>
                  <option value="5000">5,000</option>
                </select>
              </div>
            </div>
          </div>
          <div class="control-group">
            <div class="controls">
              <span tabindex="0" class="lightbtn pad1 red" id="moreFiltersButton"
                  style="margin-left: -1em">
                more filters
              </span>
            </div>
          </div>
          <div class="control-group">
            <div class="controls">
              <span tabindex="0" type="button" class="btn" id="refreshButton">Refresh</span>
              <span class="button-spinner" id="refreshButtonSpinner"></span>
              <span class="button-error-message" id="refreshButtonCancelByZoom">
                Refresh canceled by zoom action
              </span>
              <span class="button-success-message" id="refreshSuccessMessage">Refreshed</span>
            </div>
          </div>
        </fieldset>
      </form>
    </div>
    <div class="tab-pane fade" id="detailTab">
      <div class="button-spinner" id="detailTabSpinner" style="margin: 20px 30px"></div>
      <!-- the 1px padding is to give space for the focus highlight around the 'spans',
           'coarse-grained profile' and 'fine-grained profile' toggles -->
      <div id="detailTabContent" style="padding: 1px"></div>
    </div>
  </div>
  <br>
</body>
</html>
