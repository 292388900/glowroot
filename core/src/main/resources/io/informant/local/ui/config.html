<!doctype html>
<!--
  Copyright 2012 the original author or authors.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Informant | Configuration</title>
<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
<link rel="stylesheet" href="libs/bootstrap/2.1.1/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="css/informant.css" type="text/css" />
<script type="text/javascript" src="libs/jquery/1.8.1/jquery.min.js"></script>
<script type="text/javascript" src="libs/bootstrap/2.1.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="libs/handlebars/1.0.rc.1/handlebars.js"></script>
<script type="text/javascript" src="libs/spin/1.2.6/spin.min.js"></script>
<script type="text/javascript" src="js/informant.js"></script>
<script type="text/x-handlebars-template" id="pluginTemplate">
<div class="section-header" onclick="$('#form_' + escapeForSelector('{{id}}')).toggle()">
  <button class="section-toggle">{{name}}</button>
  <span class="configuration-status" id="{{id}}_status">ON</span>
</div>
<br>
<form class="section-body form-horizontal hide" id="form_{{id}}">
  <fieldset>
    <div class="section-body-padding">
      <div class="control-group">
        <label class="control-label" for="{{id}}_enabled">Enabled</label>
        <div class="controls">
          <input type="checkbox" id="{{id}}_enabled" value="true">
        </div>
      </div>
      {{#each propertyDescriptors}}
        {{#ifString type}}
          <div class="control-group">
            <label class="control-label" for="{{../../id}}_{{name}}">{{prompt}}</label>
            <div class="controls">
              <input type="text" id="{{../../id}}_{{name}}" style="width: 12em">
              {{#if description}}
                <div class="help-block">
                  {{description}}
                </div>
              {{/if}}
            </div>
          </div>
        {{/ifString}}
        {{#ifBoolean type}}
          <div class="control-group">
            <label class="control-label" for="{{../../id}}_{{name}}">{{prompt}}</label>
            <div class="controls">
              <input type="checkbox" id="{{../../id}}_{{name}}" value="true">
              {{#if description}}
                <div class="help-block">
                  {{description}}
                </div>
              {{/if}}
            </div>
          </div>
        {{/ifBoolean}}
        {{#ifDouble type}}
          <div class="control-group">
            <label class="control-label" for="{{../../id}}_{{name}}">{{prompt}}</label>
            <div class="controls">
              <input type="text" id="{{../../id}}_{{name}}" style="width: 5em">
              {{#if description}}
                <div class="help-block">
                  {{description}}
                </div>
              {{/if}}
            </div>
          </div>
        {{/ifDouble}}
      {{/each}}
    </div>
    <div class="form-actions section-body-save">
      <button type="button" class="btn" onclick="updatePluginConfig('{{id}}')">Save changes</button>
      <span class="button-success-message" id="{{id}}_saveComplete">Saved</span>
    </div>
  </fieldset>
</form>
</script>
<script type="text/javascript">
  Handlebars.registerHelper('ifString', function(type, options) {
    if (type == 'string') {
      return options.fn(this)
    } else {
      return options.inverse(this)
    }
  })
  Handlebars.registerHelper('ifBoolean', function(type, options) {
    if (type == 'boolean') {
      return options.fn(this)
    } else {
      return options.inverse(this)
    }
  })
  Handlebars.registerHelper('ifDouble', function(type, options) {
    if (type == 'double') {
      return options.fn(this)
    } else {
      return options.inverse(this)
    }
  })
  var pluginTemplate = Handlebars.compile($('#pluginTemplate').html())
  var plugins
  function read() {
    $.getJSON('config/read', function(config) {
      var coreConfig = config.coreConfig
      setStatus('#coreStatus', coreConfig.enabled, true)
      $('#coreEnabled').attr('checked', coreConfig.enabled)
      $('#persistenceThresholdMillis').val(coreConfig.persistenceThresholdMillis)
      addIntegerValidator('#persistenceThresholdMillis')
      $('#stuckThresholdSeconds').val(coreConfig.stuckThresholdSeconds)
      addIntegerValidator('#stuckThresholdSeconds')
      $('#spanStackTraceThresholdMillis').val(coreConfig.spanStackTraceThresholdMillis)
      addIntegerValidator('#spanStackTraceThresholdMillis')
      $('#maxSpans').val(coreConfig.maxSpans)
      addIntegerValidator('#maxSpans')
      $('#keepTraceSnapshotDays').val(coreConfig.keepTraceSnapshotHours / 24)
      addIntegerValidator('#keepTraceSnapshotDays')
      $('#rollingSizeMb').val(coreConfig.rollingSizeMb)
      addIntegerValidator('#rollingSizeMb')
      var coarseConfig = config.coarseProfilingConfig
      setStatus('#coarseStatus', coarseConfig.enabled)
      $('#coarseEnabled').attr('checked', coarseConfig.enabled)
      $('#coarseInitialDelayMillis').val(coarseConfig.initialDelayMillis)
      addIntegerValidator('#coarseInitialDelayMillis')
      $('#coarseIntervalMillis').val(coarseConfig.intervalMillis)
      addIntegerValidator('#coarseIntervalMillis')
      $('#coarseTotalSeconds').val(coarseConfig.totalSeconds)
      addIntegerValidator('#coarseTotalSeconds')
      var fineConfig = config.fineProfilingConfig
      setStatus('#fineStatus', fineConfig.enabled)
      $('#fineEnabled').attr('checked', fineConfig.enabled)
      $('#fineTracePercentage').val(fineConfig.tracePercentage)
      addPercentageValidator('#fineTracePercentage')
      $('#fineIntervalMillis').val(fineConfig.intervalMillis)
      addIntegerValidator('#fineIntervalMillis')
      $('#fineTotalSeconds').val(fineConfig.totalSeconds)
      addIntegerValidator('#fineTotalSeconds')
      if (fineConfig.persistenceThresholdMillis == -1) {
        $('#finePersistenceThresholdMillis').attr('readonly','readonly')
      } else {
        $('#finePersistenceThresholdOverride').attr('checked', true)
        $('#finePersistenceThresholdMillis').val(fineConfig.persistenceThresholdMillis)
      }
      addIntegerOrEmptyValidator('#finePersistenceThresholdMillis')
      var userConfig = config.userTracingConfig
      setStatus('#userStatus', userConfig.enabled)
      $('#userEnabled').attr('checked', userConfig.enabled)
      $('#userUserId').val(userConfig.userId)
      $('#userPersistenceThresholdMillis').val(userConfig.persistenceThresholdMillis)
      addIntegerValidator('#userPersistenceThresholdMillis')
      $('#userFineProfiling').attr('checked', userConfig.fineProfiling)
      plugins = config.pluginDescriptors
      for (var i = 0; i < plugins.length; i++) {
        var plugin = plugins[i]
        plugin.id = plugin.groupId + ':' + plugin.artifactId
        var propertyDescriptors = []
        for (var j = 0; j < plugin.propertyDescriptors.length; j++) {
          if (!plugin.propertyDescriptors[j].hidden) {
            propertyDescriptors.push(plugin.propertyDescriptors[j])
          }
        }
        plugin.propertyDescriptors = propertyDescriptors
        var html = pluginTemplate(plugin)
        $('#plugins').append(html)
        var enabled = config.pluginConfigs[plugin.id].enabled
        setStatus('#' + escapeForSelector(plugin.id) + '_status', enabled)
        $('#' + escapeForSelector(plugin.id) + '_enabled').attr('checked', enabled)
        var pluginConfig = config.pluginConfigs[plugin.id]
        for (var j = 0; j < plugin.propertyDescriptors.length; j++) {
          var propertyDescriptors = plugin.propertyDescriptors[j]
          var value = pluginConfig[propertyDescriptors.name]
          var selector = '#' + escapeForSelector(plugin.id + '_' + propertyDescriptors.name)
          if (propertyDescriptors.type == 'boolean') {
            $(selector).attr('checked', value)
          } else if (propertyDescriptors.type == 'double') {
            addDoubleValidator(selector)
            $(selector).val(value)
          } else {
            $(selector).val(value)
          }
        }
      }
    })
  }
  // updateCoreConfig can take a while if resizing large rolling database
  var postingUpdateCore = false
  function updateCoreConfig() {
    // handle crazy user clicking on the button because this can take a while if resizing large
    // rolling database
    if (postingUpdateCore) return
    var enabled = $('#coreEnabled').is(':checked')
    var persistenceThresholdMillis = $('#persistenceThresholdMillis').val()
    var stuckThresholdSeconds = $('#stuckThresholdSeconds').val()
    var spanStackTraceThresholdMillis = $('#spanStackTraceThresholdMillis').val()
    var maxSpans = $('#maxSpans').val()
    var keepTraceSnapshotDays = $('#keepTraceSnapshotDays').val()
    var rollingSizeMb = $('#rollingSizeMb').val()
    // handle validation
    if (!isInteger(persistenceThresholdMillis) || !isInteger(stuckThresholdSeconds)
        || !isInteger(spanStackTraceThresholdMillis) || !isInteger(maxSpans)
         || !isInteger(keepTraceSnapshotDays) || !isInteger(rollingSizeMb)) {
      return
    }
    postingUpdateCore = true
    var config = {
      'enabled': enabled,
      'persistenceThresholdMillis': parseInteger(persistenceThresholdMillis),
      'stuckThresholdSeconds': parseInteger(stuckThresholdSeconds),
      'spanStackTraceThresholdMillis': parseInteger(spanStackTraceThresholdMillis),
      'maxSpans': parseInteger(maxSpans),
      'keepTraceSnapshotHours': parseInteger(keepTraceSnapshotDays) * 24,
      'rollingSizeMb': parseInteger(rollingSizeMb)
    }
    $.post('config/core', JSON.stringify(config), function() {
      postingUpdateCore = false
      hideSpinner('#saveCoreButtonSpinner')
      showAndFadeSuccessMessage('#coreSaveComplete')
      setStatus('#coreStatus', config.enabled, true)
    })
    // in case button is clicked again before success message is hidden
    $('#saveCoreComplete').hide()
    showSpinner('#saveCoreButtonSpinner')
  }
  function updateCoarseConfig() {
    var enabled = $('#coarseEnabled').is(':checked')
    var initialDelayMillis = $('#coarseInitialDelayMillis').val()
    var intervalMillis = $('#coarseIntervalMillis').val()
    var totalSeconds = $('#coarseTotalSeconds').val()
    // handle validation
    if (!isInteger(initialDelayMillis) || !isInteger(intervalMillis) || !isInteger(totalSeconds)) {
      return
    }
    var config = {
      'enabled': enabled,
      'initialDelayMillis': parseInteger(initialDelayMillis),
      'intervalMillis': parseInteger(intervalMillis),
      'totalSeconds': parseInteger(totalSeconds)
    }
    $.post('config/profiling/coarse', JSON.stringify(config), function() {
      showAndFadeSuccessMessage('#coarseSaveComplete')
      setStatus('#coarseStatus', config.enabled)
    })
  }
  function updateFineConfig() {
    var enabled = $('#fineEnabled').is(':checked')
    var tracePercentage = $('#fineTracePercentage').val()
    var intervalMillis = $('#fineIntervalMillis').val()
    var totalSeconds = $('#fineTotalSeconds').val()
    var persistenceThresholdMillis = $('#finePersistenceThresholdMillis').val()
    // handle validation
    if (!isPercentage(tracePercentage) || !isInteger(intervalMillis) || !isInteger(totalSeconds)
        || (persistenceThresholdMillis != '' && !isInteger(persistenceThresholdMillis))) {
      return
    }
    if (persistenceThresholdMillis == '') {
      persistenceThresholdMillis = '-1'
    }
    var config = {
      'enabled': enabled,
      'tracePercentage': parsePercentage(tracePercentage),
      'intervalMillis': parseInteger(intervalMillis),
      'totalSeconds': parseInteger(totalSeconds),
      'persistenceThresholdMillis': parseInteger(persistenceThresholdMillis)
    }
    $.post('config/profiling/fine', JSON.stringify(config), function() {
      showAndFadeSuccessMessage('#fineSaveComplete')
      setStatus('#fineStatus', config.enabled)
    })
  }
  function updateUserConfig() {
    var enabled = $('#userEnabled').is(':checked')
    var persistenceThresholdMillis = $('#userPersistenceThresholdMillis').val()
    // handle validation
    if (!isInteger(persistenceThresholdMillis)) {
      return
    }
    var config = {
      'enabled': enabled,
      'userId': $('#userUserId').val(),
      'persistenceThresholdMillis': parseInteger(persistenceThresholdMillis),
      'fineProfiling': $('#userFineProfiling').is(':checked')
    }
    $.post('config/tracing/user', JSON.stringify(config), function() {
      showAndFadeSuccessMessage('#userSaveComplete')
      setStatus('#userStatus', config.enabled)
    })
  }
  function updatePluginConfig(pluginId) {
    var plugin = pluginForId(pluginId)
    var config = {
      'enabled': $('#' + escapeForSelector(pluginId) + '_enabled').is(':checked')
    }
    var validationError = false
    for (var j = 0; j < plugin.propertyDescriptors.length; j++) {
      var propertyDescriptors = plugin.propertyDescriptors[j]
      if (!propertyDescriptors.hidden) {
        var value
        var selector = '#' + escapeForSelector(plugin.id + '_' + propertyDescriptors.name)
        if (propertyDescriptors.type == 'boolean') {
          value = $(selector).is(':checked')
        } else if (propertyDescriptors.type == 'double') {
          if (isDouble($(selector).val())) {
            value = parseDouble($(selector).val())
          } else {
            validationError = true
          }
        } else {
          value = $(selector).val()
        }
        config[propertyDescriptors.name] = value
      }
    }
    // check for validation error
    if (validationError) {
      return
    }
    $.post('config/plugin/' + pluginId, JSON.stringify(config),
        function() {
          showAndFadeSuccessMessage('#' + escapeForSelector(pluginId) + '_saveComplete')
          setStatus('#' + escapeForSelector(pluginId) + '_status', config.enabled)
        })
  }
  function setStatus(selector, value, core) {
    if (value) {
      $(selector).removeClass('configuration-status-off')
      $(selector).addClass('configuration-status-on')
      $(selector).text('ON')
    } else {
      $(selector).removeClass('configuration-status-on')
      $(selector).addClass('configuration-status-off')
      $(selector).text('OFF')
    }
    if (!core && !$('#coreEnabled').is(':checked')) {
      // this needs to be set the first time through, at least for the plugin nodes which didn't
      // exist when setStatus was called for core the first time
      $(selector).css('color', '#bbb')
    }
    if (core) {
      // update other status'
      if (value) {
        $('.configuration-status').css('color', '')
      } else {
        $('.configuration-status').css('color', '#bbb')
        // except for core
        $(selector).css('color', '')
      }
    }
  }
  function pluginForId(pluginId) {
    for (var i = 0; i < plugins.length; i++) {
      if (plugins[i].id == pluginId) {
        return plugins[i]
      }
    }
    return null
  }
  function escapeForSelector(id) {
    // '.' and ':' have to be escaped for jquery selectors
    return id.replace(/\./g, '\\.').replace(/:/g, '\\:')
  }
  $(document).ready(function() {
    configureAjaxError()
    $('#finePersistenceThresholdOverride').change(function() {
      if ($('#finePersistenceThresholdOverride').is(':checked')) {
        $('#finePersistenceThresholdMillis').removeAttr('readonly')
      } else {
        $('#finePersistenceThresholdMillis').val('')
        $('#finePersistenceThresholdMillis').closest('.control-group').removeClass('error')
        $('#finePersistenceThresholdMillis').attr('readonly','readonly')
      }
    })
    read()
  })
</script>
</head>
<body class="pin-vertical-scrollbar">
  <div class="header">
    <span class="header-logo">
        <!-- lack of spaces on this line is important -->
        Informant</span><span class="header-page-name">Configuration</span>
    <div class="header-see-also dropdown pull-right">
      <!-- role is needed for keyboard nav to work (tab to link, then arrow key down) -->
      <a href="#" class="dropdown-toggle red" role="button" data-toggle="dropdown">see also:</a>
      <ul class="dropdown-menu" role="menu" style="margin: 0">
        <li role="menuitem"><a tabindex="-1" href="explorer.html">explorer</a></li>
        <li role="menuitem"><a tabindex="-1" href="admin.html">administration</a></li>
        <li role="menuitem"><a tabindex="-1" href="threads.html">thread dump</a></li>
      </ul>
    </div>
  </div>
  <br>
  <br>
  <div class="section-header" onclick="$('#coreForm').toggle()">
    <button class="section-toggle">General</button>
    <span class="configuration-status" id="coreStatus">ON</span>
  </div>
  <br>
  <form class="section-body form-horizontal hide" id="coreForm">
    <fieldset>
      <div class="section-body-padding">
        <div class="control-group">
          <label class="control-label" for="coreEnabled">Enabled</label>
          <div class="controls">
            <input type="checkbox" id="coreEnabled" value="true">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="persistenceThresholdMillis">
            Persistence threshold
          </label>
          <div class="controls">
            <div class="input-append">
              <input type="text" id="persistenceThresholdMillis" style="width: 5em">
              <span class="add-on">milliseconds</span>
              <span class="help-inline">Invalid input</span>
            </div>
            <span class="help-block">
              Any trace that exceeds this amount of time will be viewable in the explorer
              immediately as an active trace and will be persisted to disk at its completion.
            </span>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="stuckThresholdSeconds">Stuck threshold</label>
          <div class="controls">
            <div class="input-append">
              <input type="text" id="stuckThresholdSeconds" style="width: 5em">
              <span class="add-on">seconds</span>
            </div>
            <div class="help-block">
              Any trace that exceeds this amount of time will be persisted to disk immediately
              (prior to its completion). This is to guard against threads which get stuck forever
              (or at least long enough and do enough harm to the jvm that it has to be restarted).
            </div>
          </div>
        </div>
        <div class="control-group" style="display: none">
          <label class="control-label" for="spanStackTraceThresholdMillis">
            Span stack trace threshold
          </label>
          <div class="controls">
            <div class="input-append">
              <input type="text" id="spanStackTraceThresholdMillis" style="width: 5em">
              <span class="add-on">milliseconds</span>
            </div>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="maxSpans">Max spans</label>
          <div class="controls">
            <input type="text" id="maxSpans" style="width: 5em">
            <div class="help-block">
              Maximum number of spans collected for a given trace. This is useful for limiting
              the memory requirement of very very long traces that capture potentially hundreds of
              thousands of spans (e.g. large batch or background operations).
              Also, the explorer is not really optimized for viewing super large numbers of spans.
            </div>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="keepTraceSnapshotDays">
            Keep trace snapshot for days
          </label>
          <div class="controls">
            <div class="input-append">
              <input type="text" id="keepTraceSnapshotDays" style="width: 5em">
              <span class="add-on">days</span>
            </div>
            <div class="help-block">
            </div>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="rollingSizeMb">Rolling database size</label>
          <div class="controls">
            <div class="input-append">
              <input type="text" id="rollingSizeMb" style="width: 5em">
              <span class="add-on">MB</span>
            </div>
            <div class="help-block">
              Trace detail data (spans and profiling data) is persisted to disk as
              LZF-compressed json data in a rolling data file to efficiently cap the growth of this
              large data. (Trace summary data - capture time, duration, description, user ID,
              attributes, metrics - is persisted to an H2 data file by the embedded H2 database
              engine.)
            </div>
          </div>
        </div>
      </div>
      <div class="form-actions section-body-save">
        <button type="button" class="btn" onclick="updateCoreConfig()">Save changes</button>
        <!-- spinner because updating core config can take a while if resizing rolling file
             or changing trace snapshot expiration -->
        <span class="button-spinner" id="saveCoreButtonSpinner"></span>
        <span class="button-success-message" id="coreSaveComplete">Saved</span>
      </div>
    </fieldset>
  </form>
  <div class="section-header" onclick="$('#coarseForm').toggle()">
    <button class="section-toggle">Coarse-Grained Profiling</button>
    <span class="configuration-status" id="coarseStatus">ON</span>
  </div>
  <br>
  <form class="section-body form-horizontal hide" id="coarseForm">
    <fieldset>
      <div class="section-body-padding">
        <div class="control-group">
          <label class="control-label" for="coarseEnabled">Enabled</label>
          <div class="controls">
            <input type="checkbox" id="coarseEnabled" value="true">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="coarseInitialDelayMillis">
            Initial delay
          </label>
          <div class="controls">
            <div class="input-append">
              <input type="text" id="coarseInitialDelayMillis" style="width: 5em">
              <span class="add-on">milliseconds</span>
            </div>
            <div class="help-block">
              Once a trace exceeds this amount of time, the coarse-grained profiler captures stack
              traces periodically.
              The interval between successive stack trace captures is defined by the property
              directly below.
              The stack traces captured for an individual trace are merged into a tree view and
              provide a profile of the time spent in various portions of the code.
            </div>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="coarseIntervalMillis">
            Interval
          </label>
          <div class="controls">
            <div class="input-append">
              <input type="text" id="coarseIntervalMillis" style="width: 5em">
              <span class="add-on">milliseconds</span>
            </div>
            <div class="help-block">
              The interval at which the coarse-grained profiler captures stack traces (once a trace
              exceeds the initial delay directly above).
            </div>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="coarseTotalSeconds">
            Total
          </label>
          <div class="controls">
            <div class="input-append">
              <input type="text" id="coarseTotalSeconds" style="width: 5em">
              <span class="add-on">seconds</span>
            </div>
            <div class="help-block">
              The total length of time that the coarse-grained profiler captures stack traces (once
              a trace exceeds the initial delay above).
            </div>
          </div>
        </div>
      </div>
      <div class="form-actions section-body-save">
        <button type="button" class="btn" onclick="updateCoarseConfig()">Save changes</button>
        <span class="button-success-message" id="coarseSaveComplete">Saved</span>
      </div>
    </fieldset>
  </form>
  <div class="section-header" onclick="$('#fineForm').toggle()">
    <button class="section-toggle">Fine-Grained Profiling</button>
    <span class="configuration-status" id="fineStatus">ON</span>
  </div>
  <br>
  <form class="section-body form-horizontal hide" id="fineForm">
    <fieldset>
      <div class="section-body-padding">
        <div class="control-group">
          <label class="control-label" for="fineEnabled">Enabled</label>
          <div class="controls">
            <input type="checkbox" id="fineEnabled" value="true">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="fineTracePercentage">
            Trace percentage
          </label>
          <div class="controls">
            <div class="input-append">
              <input type="text" id="fineTracePercentage" style="width: 5em">
              <span class="add-on">%</span>
            </div>
            <div class="help-block">
              Apply fine-grained profiling to this percentage of traces.
            </div>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="fineIntervalMillis">
            Interval
          </label>
          <div class="controls">
            <div class="input-append">
              <input type="text" id="fineIntervalMillis" style="width: 5em">
              <span class="add-on">milliseconds</span>
            </div>
            <div class="help-block">
              The interval at which the fine-grained profiler captures stack traces (there is no
              initial delay for the fine-grained profiler).
            </div>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="fineTotalSeconds">
            Total
          </label>
          <div class="controls">
            <div class="input-append">
              <input type="text" id="fineTotalSeconds" style="width: 5em">
              <span class="add-on">seconds</span>
            </div>
            <div class="help-block">
              The total length of time that the fine-grained profiler captures stack traces.
            </div>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="finePersistenceThresholdMillis">
            Persistence threshold
          </label>
          <div class="controls">
            <div style="padding-top: 5px; padding-bottom: 5px">
              <label class="checkbox">
                <input type="checkbox" id="finePersistenceThresholdOverride" value="true">
                Override general persistence threshold
              </label>
            </div>
            <div class="input-append">
              <input type="text" id="finePersistenceThresholdMillis" style="width: 5em">
              <span class="add-on">milliseconds</span>
            </div>
            <div class="help-block">
              After going through the trouble of collecting fine-grained profiling info, it may be
              worthwhile to persist the given trace even if it doesn't hit the general persistence
              threshold.
            </div>
          </div>
        </div>
      </div>
      <div class="form-actions section-body-save">
        <button type="button" class="btn" onclick="updateFineConfig()">Save changes</button>
        <span class="button-success-message" id="fineSaveComplete">Saved</span>
      </div>
    </fieldset>
  </form>
  <div class="section-header" onclick="$('#userForm').toggle()">
    <button class="section-toggle">User Tracing</button>
    <span class="configuration-status" id="userStatus">ON</span>
  </div>
  <br>
  <form class="section-body form-horizontal hide" id="userForm">
    <fieldset>
      <div class="section-body-padding">
        <div class="control-group">
          <label class="control-label" for="userEnabled">Enabled</label>
          <div class="controls">
            <input type="checkbox" id="userEnabled" value="true">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="userUserId">
            User ID
          </label>
          <div class="controls">
            <input type="text" id="userUserId" style="width: 5em">
            <div class="help-block">
              Traces for the given user will use the persistence threshold and profiling
              configuration below.
            </div>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="userPersistenceThresholdMillis">
            Persistence threshold
          </label>
          <div class="controls">
            <div class="input-append">
              <input type="text" id="userPersistenceThresholdMillis" style="width: 5em">
              <span class="add-on">milliseconds</span>
            </div>
            <div class="help-block">
              Any trace for the given user that exceeds this amount of time will be viewable in the
              explorer immediately as an active trace and will be persisted to disk at its
              completion.
            </div>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="userFineProfiling">
            Fine profiling
          </label>
          <div class="controls">
            <input type="checkbox" id="userFineProfiling" value="true">
            <div class="help-block">
              Traces for the given user will be profiled using the fine-grained profiler.
            </div>
          </div>
        </div>
      </div>
      <div class="form-actions section-body-save">
        <button type="button" class="btn" onclick="updateUserConfig()">Save changes</button>
        <span class="button-success-message" id="userSaveComplete">Saved</span>
      </div>
    </fieldset>
  </form>
  <div id="plugins"></div>
</body>
</html>
