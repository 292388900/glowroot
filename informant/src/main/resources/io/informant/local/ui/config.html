<!doctype html>
<!--
  Copyright 2012-2013 the original author or authors.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Informant | Configuration</title>
<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon"/>
{{#if devMode}}
<link rel="stylesheet/less" type="text/css" href="less/config.less" />
<script src="lib/less/less.js"></script>
<script src="lib/requirejs/require.js"></script>
<script>
  require(['js/common'], function () {
    require(['js/config']);
  });
</script>
{{^}}
<link rel="stylesheet" type="text/css" href="{{fingerprint css/config.css}}" />
<script src="lib/requirejs/require.js"></script>
<script>
  require.config({
    paths: {
      'js/common': '{{fingerprint js/common.js}}',
      'js/config': '{{fingerprint js/config.js}}'
    }
  });
  require(['js/common'], function () {
    require(['js/config']);
  });
</script>
{{/if}}
</head>
<body class="container pin-vertical-scrollbar">
  <div class="header">
    <!-- lack of spaces on this line is important -->
    <span class="header-logo">Informant</span><span class="header-page-name">Configuration</span>
    <div class="header-see-also dropdown pull-right">
      <!-- role is needed for keyboard nav to work (tab to link, then arrow key down) -->
      <a href="#" class="dropdown-toggle informant-red" role="button" data-toggle="dropdown">
        see also:
      </a>
      <ul class="dropdown-menu" role="menu" style="margin: 0;">
        <li role="menuitem"><a tabindex="-1" href="..">traces</a></li>
        <li role="menuitem"><a tabindex="-1" href="pointcuts.html">pointcuts</a></li>
      </ul>
    </div>
  </div>
  <br>
  <div class="accordion" id="outerAccordion">
    <div class="accordion-group outer-accordion-group">
      <div class="accordion-heading outer-accordion-heading">
        <button class="flat-btn" data-toggle="collapse" data-parent="#outerAccordion"
                data-target="#generalAccordion">
          Trace Capture
        </button>
      </div>
      <div class="accordion accordion-body collapse in" id="generalAccordion">
        <div class="accordion-group">
          <div class="accordion-heading">
            <button class="flat-btn" data-toggle="collapse" data-parent="#generalAccordion"
                    data-target="#generalForm">
              General <span class="configuration-status" id="generalStatus"></span>
            </button>
          </div>
          <div class="accordion-body collapse in" id="generalForm">
            <form class="accordion-inner form-horizontal">
              <fieldset>
                <div class="accordion-form-padding">
                  <div class="control-group">
                    <label class="control-label" for="generalEnabled">Enabled</label>
                    <div class="controls">
                      <input type="checkbox" id="generalEnabled" value="true">
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="storeThresholdMillis">
                      Store threshold
                    </label>
                    <div class="controls">
                      <div class="input-append">
                        <input type="text" id="storeThresholdMillis" style="width: 5em;">
                        <span class="add-on">milliseconds</span>
                        <span class="help-inline">Invalid input</span>
                      </div>
                      <span class="help-block">
                        Any trace that exceeds this amount of time will be viewable immediately as
                        an active trace and will be stored to disk at its completion.
                      </span>
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="stuckThresholdSeconds">Stuck threshold</label>
                    <div class="controls">
                      <div class="input-append">
                        <input type="text" id="stuckThresholdSeconds" style="width: 5em;">
                        <span class="add-on">seconds</span>
                      </div>
                      <div class="help-block">
                        Any trace that exceeds this amount of time will be stored to disk
                        immediately (prior to its completion).
                        This is to guard against threads which get stuck forever (or at least long
                        enough and do enough harm to the jvm that it has to be restarted).
                      </div>
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="maxSpans">Max spans</label>
                    <div class="controls">
                      <input type="text" id="maxSpans" style="width: 5em;">
                      <div class="help-block">
                        Maximum number of spans collected for a given trace. This is useful for
                        limiting the memory requirement of very very long traces that capture
                        potentially hundreds of thousands of spans (e.g. large batch or background
                        operations).
                        Also, the ui is not really optimized for viewing super large numbers of
                        spans.
                      </div>
                    </div>
                  </div>
                </div>
                <div class="form-actions">
                  <button type="button" class="btn" id="saveGeneralButton">Save changes</button>
                  <span class="button-success-message hide" id="generalSaveComplete">Saved</span>
                </div>
              </fieldset>
            </form>
          </div>
        </div>
        <div class="accordion-group">
          <div class="accordion-heading">
            <button class="flat-btn" data-toggle="collapse" data-parent="#generalAccordion"
                    data-target="#coarseForm">
              Coarse-Grained Profiling <span class="configuration-status" id="coarseStatus"></span>
            </button>
          </div>
          <div class="accordion-body collapse" id="coarseForm">
            <form class="accordion-inner form-horizontal">
              <fieldset>
                <div class="accordion-form-padding">
                  <div class="control-group">
                    <label class="control-label" for="coarseEnabled">Enabled</label>
                    <div class="controls">
                      <input type="checkbox" id="coarseEnabled" value="true">
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="coarseInitialDelayMillis">
                      Initial delay
                    </label>
                    <div class="controls">
                      <div class="input-append">
                        <input type="text" id="coarseInitialDelayMillis" style="width: 5em;">
                        <span class="add-on">milliseconds</span>
                      </div>
                      <div class="help-block">
                        Once a trace exceeds this amount of time, the coarse-grained profiler
                        captures stack traces periodically.
                        The interval between successive stack trace captures is defined by the
                        property directly below.
                        The stack traces captured for an individual trace are merged into a tree
                        view and provide a profile of the time spent in various portions of the
                        code.
                      </div>
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="coarseIntervalMillis">
                      Interval
                    </label>
                    <div class="controls">
                      <div class="input-append">
                        <input type="text" id="coarseIntervalMillis" style="width: 5em;">
                        <span class="add-on">milliseconds</span>
                      </div>
                      <div class="help-block">
                        The interval at which the coarse-grained profiler captures stack traces
                        (once a trace exceeds the initial delay directly above).
                      </div>
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="coarseTotalSeconds">
                      Total
                    </label>
                    <div class="controls">
                      <div class="input-append">
                        <input type="text" id="coarseTotalSeconds" style="width: 5em;">
                        <span class="add-on">seconds</span>
                      </div>
                      <div class="help-block">
                        The total length of time that the coarse-grained profiler captures stack
                        traces (once a trace exceeds the initial delay above).
                      </div>
                    </div>
                  </div>
                </div>
                <div class="form-actions">
                  <button type="button" class="btn" id="saveCoarseButton">Save changes</button>
                  <span class="button-success-message hide" id="coarseSaveComplete">Saved</span>
                </div>
              </fieldset>
            </form>
          </div>
        </div>
        <div class="accordion-group">
          <div class="accordion-heading">
            <button class="flat-btn" data-toggle="collapse" data-parent="#generalAccordion"
                    data-target="#fineForm">
              Fine-Grained Profiling <span class="configuration-status" id="fineStatus"></span>
            </button>
          </div>
          <div class="accordion-body collapse" id="fineForm">
            <form class="accordion-inner form-horizontal">
              <fieldset>
                <div class="accordion-form-padding">
                  <div class="control-group">
                    <label class="control-label" for="fineEnabled">Enabled</label>
                    <div class="controls">
                      <input type="checkbox" id="fineEnabled" value="true">
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="fineTracePercentage">
                      Trace percentage
                    </label>
                    <div class="controls">
                      <div class="input-append">
                        <input type="text" id="fineTracePercentage" style="width: 5em;">
                        <span class="add-on">%</span>
                      </div>
                      <div class="help-block">
                        Apply fine-grained profiling to this percentage of traces.
                      </div>
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="fineIntervalMillis">
                      Interval
                    </label>
                    <div class="controls">
                      <div class="input-append">
                        <input type="text" id="fineIntervalMillis" style="width: 5em;">
                        <span class="add-on">milliseconds</span>
                      </div>
                      <div class="help-block">
                        The interval at which the fine-grained profiler captures stack traces (there
                        is no initial delay for the fine-grained profiler).
                      </div>
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="fineTotalSeconds">
                      Total
                    </label>
                    <div class="controls">
                      <div class="input-append">
                        <input type="text" id="fineTotalSeconds" style="width: 5em;">
                        <span class="add-on">seconds</span>
                      </div>
                      <div class="help-block">
                        The total length of time that the fine-grained profiler captures stack
                        traces.
                      </div>
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="fineStoreThresholdMillis">
                      Store threshold
                    </label>
                    <div class="controls">
                      <div style="padding-top: 5px; padding-bottom: 5px;">
                        <label class="checkbox">
                          <input type="checkbox" id="fineStoreThresholdOverride" value="true">
                          Override general store threshold
                        </label>
                      </div>
                      <div class="input-append">
                        <input type="text" id="fineStoreThresholdMillis" style="width: 5em;">
                        <span class="add-on">milliseconds</span>
                      </div>
                      <div class="help-block">
                        After going through the trouble of collecting fine-grained profiling info,
                        it may be worth while to store the given trace even if it doesn't hit the
                        general store threshold.
                      </div>
                    </div>
                  </div>
                </div>
                <div class="form-actions">
                  <button type="button" class="btn" id="saveFineButton">Save changes</button>
                  <span class="button-success-message hide" id="fineSaveComplete">Saved</span>
                </div>
              </fieldset>
            </form>
          </div>
        </div>
        <div class="accordion-group">
          <div class="accordion-heading">
            <button class="flat-btn" data-toggle="collapse" data-parent="#generalAccordion"
                    data-target="#userForm">
              User-Specific Overrides <span class="configuration-status" id="userStatus"></span>
            </button>
          </div>
          <div class="accordion-body collapse" id="userForm">
            <form class="accordion-inner form-horizontal">
              <fieldset>
                <div class="accordion-form-padding">
                  <div class="control-group">
                    <label class="control-label" for="userEnabled">Enabled</label>
                    <div class="controls">
                      <input type="checkbox" id="userEnabled" value="true">
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="userUserId">
                      User ID
                    </label>
                    <div class="controls">
                      <input type="text" id="userUserId" style="width: 10em;">
                      <div class="help-block">
                        All traces for the given user will use the store threshold and profiling
                        configuration below.
                      </div>
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="userStoreThresholdMillis">
                      Store threshold
                    </label>
                    <div class="controls">
                      <div class="input-append">
                        <input type="text" id="userStoreThresholdMillis" style="width: 5em;">
                        <span class="add-on">milliseconds</span>
                      </div>
                      <div class="help-block">
                        All traces for the given user that exceeds this amount of time will be
                        viewable immediately as an active trace and will be stored to disk at its
                        completion.
                      </div>
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="userFineProfiling">
                      Fine profiling
                    </label>
                    <div class="controls">
                      <input type="checkbox" id="userFineProfiling" value="true">
                      <div class="help-block">
                        All traces for the given user will be profiled using the fine-grained
                        profiler.
                      </div>
                    </div>
                  </div>
                </div>
                <div class="form-actions">
                  <button type="button" class="btn" id="saveUserButton">Save changes</button>
                  <span class="button-success-message hide" id="userSaveComplete">Saved</span>
                </div>
              </fieldset>
            </form>
          </div>
        </div>
        <div class="accordion-group">
          <div class="accordion-heading">
            <button class="flat-btn" data-toggle="collapse" data-parent="#generalAccordion"
                    data-target="#storageForm">
              Storage
            </button>
          </div>
          <div class="accordion-body collapse" id="storageForm">
            <form class="accordion-inner form-horizontal">
              <fieldset>
                <div class="accordion-form-padding">
                  <div class="control-group">
                    <label class="control-label" for="storageSnapshotExpirationDays">
                      Keep trace snapshots for
                    </label>
                    <div class="controls">
                      <div class="input-append">
                        <input type="text" id="storageSnapshotExpirationDays" style="width: 5em;">
                        <span class="add-on">days</span>
                      </div>
                      <div class="inline-block">
                        <button type="button" class="btn" id="deleteAllButton"
                                style="margin-left: 20px;">
                          Delete All
                        </button>
                        <span class="button-spinner inline-block hide" id="deleteAllSpinner"></span>
                        <span class="button-success-message hide"
                              id="deleteAllSuccessMessage">Deleted</span>
                      </div>
                      <div class="help-block" style="margin-top: 10px;">
                        Defines how long the trace snapshots should be retained in the H2 data file.
                        <em>Delete All</em> will clear all trace snapshots from the H2 data file.
                      </div>
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="storageRollingSizeMb">
                      Rolling data file size
                    </label>
                    <div class="controls">
                      <div class="input-append">
                        <input type="text" id="storageRollingSizeMb" style="width: 5em;">
                        <span class="add-on">MB</span>
                      </div>
                      <div class="help-block">
                        Trace detail data (spans and profiling data) is stored to disk as
                        LZF-compressed json data in a rolling data file to efficiently cap the
                        growth of this large data.
                        (Trace summary data - capture time, duration, headline, user ID, attributes,
                        metrics - is stored to an H2 data file by the embedded H2 database engine.)
                      </div>
                    </div>
                  </div>
                  <div class="control-group">
                    <label class="control-label" for="storageDataDir">Data directory</label>
                    <div class="controls">
                      <span class="uneditable-input" id="storageDataDir"></span>
                      <div class="help-block">
                        The data directory where the H2 data file and the rolling database are
                        stored.
                        The default value is the directory where the informant.jar resides.
                        This can only be changed on the command line, using
                        <span class="nowrap">-Dinformant.data.dir=&lt;folder&gt;</span>.
                      </div>
                    </div>
                  </div>
                </div>
                <div class="form-actions">
                  <button type="button" class="btn" id="saveStorageButton">Save changes</button>
                  <!-- spinner because updating storage config can take a while if resizing rolling
                       file or changing trace snapshot expiration -->
                  <span class="button-spinner inline-block hide" id="saveStorageButtonSpinner">
                  </span>
                  <span class="button-success-message hide" id="storageSaveComplete">Saved</span>
                </div>
              </fieldset>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="accordion-group outer-accordion-group">
      <div class="accordion-heading outer-accordion-heading">
        <button class="flat-btn" data-toggle="collapse" data-parent="#outerAccordion"
                data-target="#pluginAccordion">
          Plugins
        </button>
      </div>
      <div class="accordion accordion-body collapse" id="pluginAccordion"></div>
    </div>
  </div>
  <span class="offscreen" id="offscreenMeasure"></span>
</body>
</html>
